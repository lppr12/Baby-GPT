<!DOCTYPE html>
<html>
   <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Sasta_GPT</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js" integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.10.2/umd/popper.min.js" integrity="sha512-nnzkI2u2Dy6HMnzMIkh7CPd1KX445z38XIu4jG1jGw7x5tSL3VBjE44dY4ihMU1ijAQV930SPM12cCFrB18sVw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.3/font/bootstrap-icons.min.css" integrity="sha512-YFENbnqHbCRmJt5d+9lHimyEMt8LKSNTMLSaHjvsclnZGICeY/0KYEeiHwD1Ux4Tcao0h60tdcMv+0GljvWyHg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="styles.css">


    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto&display=swap">



    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=PT+Serif&family=Source+Serif+Pro:ital,wght@1,600&display=swap" rel="stylesheet">

    


<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script>


<!--  -->
<script src="script.js">





function generateUniqueId() {
  const timestamp = Date.now();
  const randomNumber = Math.random();
  const hexadecimalString = randomNumber.toString(16);

  return `id-${timestamp}-${hexadecimalString}`;
}



  function getCurrentTime() {
    const now = new Date();
    const hours = now.getHours().toString().padStart(2, "0");
    const minutes = now.getMinutes().toString().padStart(2, "0");
    return `${hours}:${minutes}`;
  }
  



  function typeText(element, text) {
    let index = 0

    let interval = setInterval(() => {
        if (index < text.length) {
            element.innerHTML += text.charAt(index)
            index++
        } else {
            clearInterval(interval)
        }
    }, 20)
}





  const textarea = document.querySelector('textarea');
  const chatBox = document.querySelector('.texts');
  

  function loader(element) {
    element.innerHTML = `
      <div class="loader">
        <div class="loader-dots">
          <span class="loader-dot"></span>
          <span class="loader-dot"></span>
          <span class="loader-dot"></span>
        </div>
        <div class="loader-text">
          <div class="loader-text-1"></div>
          <div class="loader-text-2"></div>
          <div class="loader-text-3"></div>
        </div>
      </div>
    `;
  
    return true;
  }
  


// Retrieve the conversation data from local storage
const conversation = JSON.parse(localStorage.getItem('conversation') || '[]');


//sendind the conversation history
const prompts = conversation.filter(item => item.sender === 'user').map(item => item.prompt);
const botResponses = conversation.filter(item => item.sender === 'bot').map(item => item.bot || '');
const context = prompts.map((prompt, i) => prompt + '\n' + botResponses[i]).join('\n');


// Display the conversation data in the chat box
if (conversation.length > 1) {
  const messages = conversation.map(message => {
    if (message.sender === 'user') {
      return `
        <div class="message sent">
          <div class="message-content">
            <div class="sent_t">${message.prompt}
              <p class="text-end time text-muted">${message.time}</p>
            </div>
          </div>
        </div>
      `;
    } else {
      return `
        <div class="message received">
          <div class="message-content">
            <div class="received_t">
              
            ${data.bot.split('\n').filter(line => line.trim() !== '').map((line, index) => {
              if (index === 0) {
                // Remove leading whitespace and "A:" prefix from first line
                return `<p>${line.trim().replace(/^A:\s*/, '')}</p>`;
              } else {
                return `<p>${line.trim()}</p>`;
              }
            }).join('<br>')}
              <p class="text-end time text-muted">${message.time}</p>
            </div>
          </div>
        </div>
      `;
    }
  });
  chatBox.innerHTML = messages.join('');
  chatBox.scrollTop = chatBox.scrollHeight;
}




 // const conversation = []; //test



 async function sendMessage() {
  const prompt = textarea.value.trim();
  const time = getCurrentTime(); 
  if (prompt !== '') {
    const newMessage = `
      <div class="message sent ">
        <div class="message-content">
          <div class="sent_t">${prompt}
            <p class="text-end time text-muted">${time}</p>
          </div>
        </div>
      </div>
    `;
    chatBox.insertAdjacentHTML('beforeend', newMessage);
    chatBox.scrollTop = chatBox.scrollHeight;
    textarea.value = '';
    
    // // Store the user message in local storage
     const conversation = JSON.parse(localStorage.getItem('conversation') || '[]');
     conversation.push({ prompt, time ,sender: 'user' });
     localStorage.setItem('conversation', JSON.stringify(conversation));
    // // 



    const loaderText = document.createElement('p');
    loaderText.textContent = 'Loading';
    const loaderInterval = loader(loaderText);
    chatBox.appendChild(loaderText);

    try {
      const response = await fetch('https://babygpt.onrender.com', {
        method: 'POST',
        headers: { 
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ prompt, conversation })
      });
      clearInterval(loaderInterval);

      const data = await response.json();

      // Store the bot response in local storage
      conversation.push({ bot: data.bot, time , sender: 'bot' });
      localStorage.setItem('conversation', JSON.stringify(conversation));

      const botMessage = `
        <div class="message received">
          <div class="message-content">
            <div class="received_t" >
           
            ${data.bot.split('\n').filter(line => line.trim() !== '').map((line, index) => {
              if (index === 0) {
                // Remove leading whitespace and "A:" prefix from first line
                return `<p>${line.trim().replace(/^A:\s*/, '')}</p>`;
              } else {
                return `<p>${line.trim()}</p>`;
              }
            }).join('<br>')}
            <p class="text-end time text-muted">${getCurrentTime()}</p>
            </div>
          </div>
        </div>
      `;

      chatBox.insertAdjacentHTML('beforeend', botMessage);
      loaderText.remove();
      chatBox.scrollTop = chatBox.scrollHeight;
    } catch (error) {
      alert(error);
      console.log(error);
      clearInterval(loaderInterval);
      loaderText.remove();
    }
  }
  
}





  function handleKeyDown(event) {
    if (event.keyCode === 13 && !event.shiftKey) {
      event.preventDefault();
      sendMessage();
    }
  }




  


// Title

var textWrapper = document.querySelector('.ml1 .letters');
textWrapper.innerHTML = textWrapper.textContent.replace(/\S/g, "<span class='letter'>$&</span>");

anime.timeline({loop: true})
  .add({
    targets: '.ml1 .letter',
    scale: [0.3,1],
    opacity: [0,1],
    translateZ: 0,
    easing: "easeOutExpo",
    duration: 600,
    delay: (el, i) => 70 * (i+1)
  }).add({
    targets: '.ml1 .line',
    scaleX: [0,1],
    opacity: [0.5,1],
    easing: "easeOutExpo",
    duration: 700,
    offset: '-=875',
    delay: (el, i, l) => 80 * (l - i)
  }).add({
    targets: '.ml1',
    opacity: 0,
    duration: 1000,
    easing: "easeOutExpo",
    delay: 1000
  });

  

  function clearLocalStorage() {
    localStorage.clear();
  }

</script>
<!--  -->
   </head> 

  

   <body class="bgrclr">

   
    <div class="container-fluid">
      




      <div class="row r1">
        <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark nav1">
          <div class="container-fluid">
            <div class="navbar-brand " href="index.html">
              

              <div class="ml1">
                <span class="text-wrapper">
                  <!-- <span class="line line1"></span> -->
                  <span class="letters">Baby GPT</span>
                  <span class="line line2"></span>
                </span>
              </div>
            </div>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="#">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#">Contact</a>
                </li>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Themes
                  </a>
                  <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <li><button class="dropdown-item" href="#">Action</button></li>
                    <li><button class="dropdown-item" href="#">Another action</button></li>
                    <li><button class="dropdown-item" href="#">Something else here</button></li>
                  </ul>
                </li>
                <li class="nav-item clearbut">
                  <button class="btn btn-danger btn-sm" onclick=clearLocalStorage()><font id="clrbut">Clear History</font></button>
                </li>
              </ul>
             
              
            </div>
          </div>
        </nav>
      </div>
  
   <br><br>
  
            
            
          
            
              <div class="card-body texts">

                <!-- <div class="message sent">
                  <div class="message-content">
                    <div class=" sent_t">Hi there!
                      <p class="time"></p>
                    </div>
                  </div>
                </div>

                <div class="message received">
                  <div class="message-content">
                    <div class="received_t">Hello
                      <p class="time "></p>
                    </div>
                  </div>
                </div> -->
  
              </div>
            


            
            <div class="row r2">
              <footer class="fixed-bottom">
               
                <div class="textbar">
                  <textarea class="align1" id="textarea1" placeholder="Ask anything..." onkeydown="handleKeyDown(event)"></textarea>
                  <button type="submit" id="subbut" onclick="sendMessage()"><i class="bi bi-send"></i></button>
                </div>
                
                
              </footer>
            </div>

    
          




      


      
   </body>

</html>